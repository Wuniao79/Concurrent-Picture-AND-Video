# index.html 结构拆解（按功能段落）

说明：下列行号对应 `third_party/index.html`（使用 `rg -n` 得到的关键锚点），便于定位每一段的职责。内容按模块拆分，覆盖每一块代码的功能边界与依赖关系。

## 1. HTML 头部与依赖
- 1-8：HTML 声明、语言、字符集、视口配置、标题。
- 9-10：外部库（`marked` 用于 Markdown 解析，`JSZip` 用于打包下载）。
- 11-917：全局 CSS 变量与通用样式（主题色、背景、阴影、滚动条、布局尺寸）。

## 2. 主题与暗黑模式覆盖
- 34-360：`[data-theme="dark"]` 的全局覆盖与组件级暗黑模式适配。
- 660-870：Banana（提示词库）暗黑模式细节样式。

## 3. 主布局与通用组件 CSS
- 920-1060：基础布局（`body`、`sidebar`、`main-area`、`header`、`chat-history`）。
- 1015-1045：空态、输入栏、上传预览、按钮基础样式。
- 1063-1115：右侧“设置栏”与分辨率/长宽比按钮样式。
- 1120-1140：图片预览、Lightbox 及交互按钮样式。

## 4. XHS 灵感实验室（布局样式）
- 1140-1455：XHS 三栏布局、侧栏折叠、移动端遮罩与自适应样式。

## 5. 图片分割工厂（布局样式）
- 1466-1510：切片工具的头部、工具条、画布区、结果网格样式。

## 6. Banana 提示词库（布局样式）
- 1507-1701：提示词卡片、标签、搜索框、分页等样式。

## 7. 响应式与移动端布局
- 1701-1715：移动端 sidebar 与 settings 的抽屉逻辑样式。

## 8. 主体结构（HTML）
- 1724：`<body>` 入口。
- 1737-1762：左侧 sidebar（“新建对话 + XHS / 提示词快查 / 表情包 / 图片切割”等）。
- 1764-1802：主内容区（header、empty-state、chat-history、输入区）。
- 1803-1846：右侧设置栏（分辨率、长宽比、流式开关等）。

## 9. XHS Modal（结构）
- 1881-2013：XHS 弹层、三栏布局、侧栏折叠开关、历史记录与输入区。

## 10. Banana 提示词库 Modal（结构）
- 2015-2057：提示词库弹层、搜索、分类筛选与卡片容器。

## 11. 图片分割工厂 Modal（结构）
- 2059-2123：切片工具弹层、上传、分割线、生成切片、下载入口。

## 12. 公共遮罩 / Toast / 进度条
- 2125-2130：Lightbox。
- 2128-2136：Toast。
- 2139-2167：全局加载与进度条。

## 13. 通用工具函数
- 2137-2230：`escapeHtml`、`showToast`、`LoadingManager`、`ProgressBar`。

## 14. BananaTool（提示词库逻辑）
- 2244-2384：数据拉取（多源 fallback）、搜索筛选、卡片渲染、复制剪贴板。

## 15. XHS 数据存储（IndexedDB）
- 2388-2398：XHS 历史数据库增删查清。

## 16. XHSCreator（灵感实验室逻辑）
- 2399-2970：配置、图片引用、生成方案、历史管理、批量生成。

## 17. SlicerTool（图片切片逻辑）
- 3000-3061：切片工具初始化、画线、切片、导出。

## 18. ProviderManager 与会话系统
- 3063-3090：API 渠道管理（增删查、随机渠道）。
- 3065-3091：IndexedDB 会话与消息存储。
- 3091-3380：聊天 UI 绑定、发送逻辑、生成流程、流式处理。

## 19. 绘图参数（分辨率 & 长宽比）
- 3091：全局 `state` 中 `resolution` 与 `aspectRatio`。
- 3162-3177：OpenAI 图像请求参数（`size`、`aspect_ratio`）。
- 3275-3277：Gemini 图像参数（`generationConfig.imageConfig`）。

## 20. 其他
- 3435+：用于提示跨域或下载的 HTML 模板片段。

